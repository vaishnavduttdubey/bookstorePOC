"use strict";(globalThis.webpackChunk_clerk_clerk_js=globalThis.webpackChunk_clerk_clerk_js||[]).push([["4616"],{84808:function(e,t,i){i.r(t),i.d(t,{APIKeys:()=>R,APIKeysPage:()=>A}),i(50725),i(65223);var a=i(73312),o=i(41024),r=i(40851),l=i(69144),n=i(79281),s=i(11576),d=i(64204),c=i(99805),p=i(2672),u=i(81319),y=i(77691),m=i(96352),h=i(96519),x=i(51217),K=i(27284),_=i(33009),g=i(92156);let f=e=>{let{rows:t,isLoading:i,onRevoke:o,elementDescriptor:r,canManageAPIKeys:l}=e;return(0,a.tZ)(d.Flex,{sx:e=>({width:"100%",[x.mqu.sm]:{overflowX:"auto",padding:e.space.$0x25}}),children:(0,a.BX)(d.Table,{sx:e=>({background:e.colors.$colorBackground}),elementDescriptor:r,children:[(0,a.tZ)(d.Thead,{children:(0,a.BX)(d.Tr,{children:[(0,a.tZ)(d.Th,{children:"Name"}),(0,a.tZ)(d.Th,{children:"Last used"}),l&&(0,a.tZ)(d.Th,{children:"Actions"})]})}),(0,a.tZ)(d.Tbody,{children:i?(0,a.tZ)(d.Tr,{children:(0,a.tZ)(d.Td,{colSpan:3,children:(0,a.tZ)(d.Spinner,{colorScheme:"primary",sx:{margin:"auto",display:"block"},elementDescriptor:d.descriptors.spinner})})}):t.length?t.map(e=>(0,a.BX)(d.Tr,{children:[(0,a.tZ)(d.Td,{children:(0,a.BX)(d.Flex,{direction:"col",sx:{minWidth:"25ch"},children:[(0,a.tZ)(d.Text,{variant:"subtitle",truncate:!0,children:e.name}),(0,a.tZ)(d.Text,{variant:"caption",colorScheme:"secondary",localizationKey:e.expiration?(0,d.localizationKeys)("apiKeys.createdAndExpirationStatus__expiresOn",{createdDate:e.createdAt,expiresDate:e.expiration}):(0,d.localizationKeys)("apiKeys.createdAndExpirationStatus__never",{createdDate:e.createdAt})})]})}),(0,a.tZ)(d.Td,{children:(0,a.tZ)(d.Box,{sx:{minWidth:"10ch"},children:(0,a.tZ)(d.Text,{localizationKey:e.lastUsedAt?(0,g.S)(e.lastUsedAt):"-"})})}),l&&(0,a.tZ)(d.Td,{children:(0,a.tZ)(_.a,{actions:[{label:(0,d.localizationKeys)("apiKeys.menuAction__revoke"),isDestructive:!0,onClick:()=>o(e.id,e.name)}]})})]},e.id)):(0,a.tZ)(v,{})})]})})},v=()=>(0,a.tZ)(d.Tr,{children:(0,a.tZ)(d.Td,{colSpan:4,children:(0,a.tZ)(d.Text,{localizationKey:(0,d.localizationKeys)("apiKeys.detailsTitle__emptyRow"),sx:{margin:"auto",display:"block",width:"fit-content"}})})});var Z=i(44709),D=i(70431),b=i(19460),C=i(68487),T=i(3146),F=i(36788);let z=["never","1d","7d","30d","60d","90d","180d","1y"],S={"1d":e=>e.setDate(e.getDate()+1),"7d":e=>e.setDate(e.getDate()+7),"30d":e=>e.setDate(e.getDate()+30),"60d":e=>e.setDate(e.getDate()+60),"90d":e=>e.setDate(e.getDate()+90),"180d":e=>e.setDate(e.getDate()+180),"1y":e=>e.setFullYear(e.getFullYear()+1)},w=e=>{if("never"===e||!e)return;let t=new Date,i=new Date(t);return S[e](i),Math.floor((i.getTime()-t.getTime())/1e3)},k=e=>{var t;let{selectedExpiration:i,setSelectedExpiration:o}=e,r=(0,l.useRef)(null),{t:n}=(0,d.useLocalizations)(),s=z.map(e=>({value:e,label:n((0,d.localizationKeys)((e=>{switch(e){case"never":return"apiKeys.formFieldOption__expiration__never";case"1d":return"apiKeys.formFieldOption__expiration__1d";case"7d":return"apiKeys.formFieldOption__expiration__7d";case"30d":return"apiKeys.formFieldOption__expiration__30d";case"60d":return"apiKeys.formFieldOption__expiration__60d";case"90d":return"apiKeys.formFieldOption__expiration__90d";case"180d":return"apiKeys.formFieldOption__expiration__180d";case"1y":return"apiKeys.formFieldOption__expiration__1y"}})(e)))}));return(0,a.BX)(T.Ph,{elementId:"apiKeyExpiration",options:s,value:null!=(t=null==i?void 0:i.value)?t:"",onChange:o,placeholder:n((0,d.localizationKeys)("formFieldInputPlaceholder__apiKeyExpirationDate")),referenceElement:r,children:[(0,a.tZ)(T.UN,{ref:r,icon:h.jC,sx:e=>({justifyContent:"space-between",backgroundColor:e.colors.$colorBackground}),"aria-labelledby":"expiration-field",id:"expiration-field"}),(0,a.tZ)(T.pp,{sx:e=>({paddingBlock:e.space.$1,color:e.colors.$colorForeground})})]})},I=e=>{let{onCreate:t}=e,[i,o]=(0,l.useState)(null),{close:r}=(0,Z.XC)(),{showDescription:n=!1}=(0,s.useAPIKeysContext)(),c=(0,p.useCardState)(),{t:u}=(0,d.useLocalizations)(),y=(0,F.Yp)("name","",{type:"text",label:(0,d.localizationKeys)("formFieldLabel__apiKeyName"),placeholder:(0,d.localizationKeys)("formFieldInputPlaceholder__apiKeyName"),isRequired:!0}),m=(0,F.Yp)("apiKeyDescription","",{type:"text",label:(0,d.localizationKeys)("formFieldLabel__apiKeyDescription"),placeholder:(0,d.localizationKeys)("formFieldInputPlaceholder__apiKeyDescription"),isRequired:!1}),h=y.value.length>2,K=(0,l.useMemo)(()=>{let e=w(null==i?void 0:i.value);if(!(null==i?void 0:i.value)||!e)return u((0,d.localizationKeys)("apiKeys.formFieldCaption__expiration__never"));let t=new Date(Date.now()+1e3*e);return u((0,d.localizationKeys)("apiKeys.formFieldCaption__expiration__expiresOn",{date:t.toLocaleString(void 0,{year:"numeric",month:"long",day:"2-digit",hour:"numeric",minute:"2-digit",second:"2-digit",hour12:!0,timeZoneName:"short"})}))},[null==i?void 0:i.value]);return(0,a.tZ)(C.Y,{headerTitle:(0,d.localizationKeys)("apiKeys.formTitle"),headerSubtitle:(0,d.localizationKeys)("apiKeys.formHint"),elementDescriptor:d.descriptors.apiKeysCreateForm,children:(0,a.BX)(D.l.Root,{onSubmit:e=>{e.preventDefault(),t({name:y.value,description:m.value||void 0,secondsUntilExpiration:w(null==i?void 0:i.value)})},children:[(0,a.BX)(d.Box,{sx:e=>({gap:e.space.$4,display:"flex",flexDirection:"row",[x.mqu.sm]:{flexDirection:"column"}}),children:[(0,a.tZ)(D.l.ControlRow,{sx:{flex:1},elementId:y.id,elementDescriptor:d.descriptors.apiKeysCreateFormNameInput,children:(0,a.tZ)(D.l.PlainInput,{...y.props})}),(0,a.BX)(d.Col,{sx:{flex:1,width:"100%"},gap:2,elementDescriptor:d.descriptors.apiKeysCreateFormExpirationInput,children:[(0,a.BX)(d.FormLabel,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",flexDirection:"row"},htmlFor:"expiration-field",children:[(0,a.tZ)(d.Text,{as:"span",variant:"subtitle",localizationKey:(0,d.localizationKeys)("formFieldLabel__apiKeyExpiration")}),(0,a.tZ)(d.Text,{variant:"caption",colorScheme:"secondary",localizationKey:(0,d.localizationKeys)("formFieldHintText__optional")})]}),(0,a.tZ)(k,{selectedExpiration:i,setSelectedExpiration:o}),(0,a.tZ)(d.Text,{variant:"caption",colorScheme:"secondary",localizationKey:K,elementDescriptor:d.descriptors.apiKeysCreateFormExpirationCaption})]})]}),n&&(0,a.tZ)(d.Col,{sx:e=>({borderTopWidth:e.borderWidths.$normal,borderTopStyle:e.borderStyles.$solid,borderTopColor:e.colors.$borderAlpha100,paddingTop:e.space.$4,paddingBottom:e.space.$4}),children:(0,a.tZ)(D.l.ControlRow,{elementId:m.id,elementDescriptor:d.descriptors.apiKeysCreateFormDescriptionInput,children:(0,a.tZ)(D.l.PlainInput,{...m.props})})}),(0,a.tZ)(b.A,{submitLabel:(0,d.localizationKeys)("apiKeys.formButtonPrimary__add"),isDisabled:!h,onReset:r,isLoading:c.isLoading,elementDescriptor:d.descriptors.apiKeysCreateFormSubmitButton})]})})},B=(0,l.lazy)(()=>i.e("1642").then(i.bind(i,81516)).then(e=>({default:e.RevokeAPIKeyConfirmationModal}))),P=(0,l.lazy)(()=>Promise.all([i.e("9573"),i.e("5672")]).then(i.bind(i,85040)).then(e=>({default:e.CopyAPIKeyModal}))),A=e=>{let{subject:t,perPage:i,revokeModalRoot:s}=e,_=(0,K.ir)(t),g=(0,n.N2)({permission:"org:sys_api_keys:read"}),v=(0,n.N2)({permission:"org:sys_api_keys:manage"}),[Z,D]=(0,l.useState)(""),b=(0,m.Nr)(Z,500).trim(),{data:C,isLoading:T,isFetching:F,page:z,fetchPage:S,pageCount:w,count:k,revalidate:A}=(0,r.u3)({subject:t,pageSize:null!=i?i:10,query:b,keepPreviousData:!0,enabled:!_||g});(e=>{let{query:t,page:i,pageCount:a,isFetching:o,fetchPage:r}=e,n=(0,l.useRef)(t);(0,l.useEffect)(()=>{n.current!==t&&(n.current=t,r(1))},[t,r]),(0,l.useEffect)(()=>{!o&&a>0&&i>a&&r(Math.max(1,a))},[a,i,o,r])})({query:b,page:z,pageCount:w,isFetching:F,fetchPage:S});let R=k>0?Math.max(0,(z-1)*(null!=i?i:10))+1:0,O=Math.min(z*(null!=i?i:10),k),E=(0,p.useCardState)(),L=(0,r.cL)(),[X,$]=(0,l.useState)(null),{t:N}=(0,d.useLocalizations)(),[M,j]=(0,l.useState)(!1),[Y,q]=(0,l.useState)(""),[U,W]=(0,l.useState)(""),[H,G]=(0,l.useState)(!1),J=async e=>{try{E.setLoading();let i=await L.apiKeys.create({...e,subject:t});A(),E.setError(void 0),G(!0),$(i)}catch(e){(0,o.kD)(e)&&409===e.status&&E.setError("API Key name already exists")}finally{E.setIdle()}};return(0,a.BX)(d.Col,{gap:4,sx:{width:"100%"},elementDescriptor:d.descriptors.apiKeys,children:[(0,a.BX)(c.a.Root,{children:[(0,a.BX)(d.Flex,{justify:"between",align:"center",gap:4,sx:{[x.mqu.sm]:{flexDirection:"column",alignItems:"stretch"}},elementDescriptor:d.descriptors.apiKeysHeader,children:[(0,a.tZ)(d.Box,{elementDescriptor:d.descriptors.apiKeysSearchBox,children:(0,a.tZ)(u.W,{placeholder:N((0,d.localizationKeys)("apiKeys.action__search")),leftIcon:(0,a.tZ)(d.Icon,{icon:h.Yt,sx:e=>({color:e.colors.$colorMutedForeground})}),value:Z,type:"search",autoCapitalize:"none",spellCheck:!1,onChange:e=>D(e.target.value),elementDescriptor:d.descriptors.apiKeysSearchInput})}),(_&&v||!_)&&(0,a.tZ)(c.a.Trigger,{value:"add-api-key",hideOnActive:!1,children:(0,a.tZ)(d.Button,{variant:"solid",localizationKey:(0,d.localizationKeys)("apiKeys.action__add"),elementDescriptor:d.descriptors.apiKeysAddButton})})]}),(0,a.tZ)(c.a.Open,{value:"add-api-key",children:(0,a.tZ)(d.Flex,{sx:e=>({paddingTop:e.space.$6,paddingBottom:e.space.$6}),children:(0,a.tZ)(c.a.Card,{sx:{width:"100%"},children:(0,a.tZ)(I,{onCreate:J})})})}),(0,a.tZ)(P,{isOpen:H,onOpen:()=>G(!0),onClose:()=>G(!1),apiKeyName:(null==X?void 0:X.name)||"",apiKeySecret:(null==X?void 0:X.secret)||"",modalRoot:s})]}),(0,a.tZ)(f,{rows:C,isLoading:T,onRevoke:(e,t)=>{q(e),W(t),j(!0)},elementDescriptor:d.descriptors.apiKeysTable,canManageAPIKeys:_&&v||!_}),w>1&&(0,a.tZ)(y.t,{count:w,page:Math.min(z,w),onChange:e=>{S(e)},siblingCount:1,rowInfo:{allRowsCount:k,startingRow:R,endingRow:O}}),(0,a.tZ)(B,{isOpen:M,onOpen:()=>j(!0),onClose:()=>{q(""),W(""),j(!1)},apiKeyID:Y,apiKeyName:U,onRevokeSuccess:A,modalRoot:s})]})},R=(0,s.withCoreUserGuard)((0,p.withCardStateProvider)(()=>{var e,t,i;let o=(0,s.useAPIKeysContext)(),{user:l}=(0,r.aF)(),n=(0,r.mP)(),c=null!=(i=null!=(t=null==n||null==(e=n.organization)?void 0:e.id)?t:null==l?void 0:l.id)?i:"";return(0,a.tZ)(d.Flow.Root,{flow:"apiKeys",sx:{width:"100%"},children:(0,a.tZ)(A,{subject:c,perPage:o.perPage})})}))}}]);
"use strict";(globalThis.webpackChunk_clerk_clerk_js=globalThis.webpackChunk_clerk_clerk_js||[]).push([["6965"],{51367:function(e,i,t){t.r(i),t.d(i,{SubscriptionDetails:()=>S}),t(92037),t(65223),t(38062),t(50725);var l=t(73312),n=t(40851),a=t(69144),o=t(13559),r=t(1677),s=t(29629),c=t(48216),u=t(2672),d=t(81102),p=t(28e3),b=t(88870),m=t(39082),g=t(11576),y=t(64204),h=t(95746);let D=a.createContext({confirmationOpen:!1,setConfirmationOpen:()=>{},subscription:null,setSubscription:()=>{}}),S=e=>(0,l.tZ)(y.Flow.Root,{flow:"subscriptionDetails",children:(0,l.tZ)(y.Flow.Part,{children:(0,l.tZ)(d.Drawer.Content,{children:(0,l.tZ)(r.I.Provider,{value:{componentName:"SubscriptionDetails",...e},children:(0,l.tZ)(g.SubscriberTypeContext.Provider,{value:e.for,children:(0,l.tZ)(x,{...e})})})})})});function v(e){let{subscriptionItems:i,isLoading:t}=(0,g.useSubscription)(),l=null==i?void 0:i.find(e=>"active"===e.status),n=null==i?void 0:i.find(e=>"upcoming"===e.status),a=null==i?void 0:i.find(e=>"past_due"===e.status);if((null==e?void 0:e.or)==="throw"&&!l&&!a)throw Error("No active or past due subscription found");return{upcomingSubscription:n,pastDueSubscription:a,activeSubscription:l,anySubscription:n||l||a,isLoading:t}}let x=e=>{let[i,t]=(0,a.useState)(null),[n,o]=(0,a.useState)(!1),{subscriptionItems:r,isLoading:s}=(0,g.useSubscription)(),{activeSubscription:c,pastDueSubscription:u}=v();return s?(0,l.tZ)(y.Spinner,{sx:{margin:"auto"}}):c||u?(0,l.BX)(D.Provider,{value:{subscription:i,setSubscription:t,confirmationOpen:n,setConfirmationOpen:o},children:[(0,l.tZ)(d.Drawer.Header,{title:(0,y.localizationKeys)("billing.subscriptionDetails.title")}),(0,l.tZ)(d.Drawer.Body,{sx:e=>({display:"flex",flexDirection:"column",flex:1,overflowY:"auto",padding:e.space.$4,gap:e.space.$4}),children:null==r?void 0:r.map(i=>(0,l.tZ)(Z,{subscription:i,...e},i.id))}),(0,l.tZ)(z,{})]}):null},z=(0,u.withCardStateProvider)(()=>{var e;let i=(0,g.useSubscriberTypeContext)(),{isLoading:t,error:o,setError:s,setLoading:p,setIdle:m}=(0,u.useCardState)(),{subscription:h,confirmationOpen:S,setConfirmationOpen:v}=(0,a.useContext)(D),{data:x}=(0,g.useSubscription)(),{setIsOpen:z}=(0,d.useDrawerContext)(),{onSubscriptionCancel:C}=(0,r.F)(),Z=(0,n.mP)(),K=(0,a.useCallback)(e=>v(e),[v]),B=(0,a.useCallback)(async()=>{var e;h&&(s(void 0),p(),await h.cancel({orgId:"organization"===i?null==Z||null==(e=Z.organization)?void 0:e.id:void 0}).then(()=>{null==C||C(),z&&z(!1)}).catch(e=>{(0,b.S3)(e,[],s)}).finally(()=>{m()}))},[h,s,p,i,null==Z||null==(e=Z.organization)?void 0:e.id,C,z,m]);return(null==x?void 0:x.nextPayment)?(0,l.BX)(d.Drawer.Footer,{children:[(0,l.tZ)(f,{}),(0,l.tZ)(d.Drawer.Confirmation,{open:S,onOpenChange:K,actionsSlot:(0,l.BX)(l.HY,{children:[!t&&(0,l.tZ)(y.Button,{variant:"ghost",size:"sm",textVariant:"buttonLarge",onClick:()=>{m(),s(void 0),K(!1)},localizationKey:(null==h?void 0:h.isFreeTrial)?(0,y.localizationKeys)("billing.keepFreeTrial"):(0,y.localizationKeys)("billing.keepSubscription")}),(0,l.tZ)(y.Button,{variant:"solid",colorScheme:"danger",size:"sm",textVariant:"buttonLarge",isLoading:t,onClick:()=>void B(),localizationKey:(null==h?void 0:h.isFreeTrial)?(0,y.localizationKeys)("billing.cancelFreeTrial",{plan:h.plan.name}):(0,y.localizationKeys)("billing.cancelSubscription")})]}),children:h?(0,l.BX)(l.HY,{children:[(0,l.tZ)(y.Heading,{elementDescriptor:y.descriptors.drawerConfirmationTitle,as:"h2",textVariant:"h3",localizationKey:(null==h?void 0:h.isFreeTrial)?(0,y.localizationKeys)("billing.cancelFreeTrialTitle",{plan:h.plan.name}):(0,y.localizationKeys)("billing.cancelSubscriptionTitle",{plan:"".concat("upcoming"===h.status?"upcoming ":"").concat(h.plan.name)})}),(0,l.tZ)(y.Text,{elementDescriptor:y.descriptors.drawerConfirmationDescription,colorScheme:"secondary",localizationKey:(null==h?void 0:h.isFreeTrial)?(0,y.localizationKeys)("billing.cancelFreeTrialAccessUntil",{plan:h.plan.name,date:h.periodEnd}):"upcoming"===h.status?(0,y.localizationKeys)("billing.cancelSubscriptionNoCharge"):"past_due"===h.status?(0,y.localizationKeys)("billing.cancelSubscriptionPastDue"):(0,y.localizationKeys)("billing.cancelSubscriptionAccessUntil",{plan:h.plan.name,date:h.periodEnd})}),(0,l.tZ)(c.m,{children:o})]}):null})]}):null});function f(){let{activeSubscription:e}=v({or:"throw"}),{data:i}=(0,g.useSubscription)();if(!(null==i?void 0:i.nextPayment)||!e)return null;let{isFreeTrial:t}=e;return(0,l.BX)(p.a.Root,{children:[(0,l.BX)(p.a.Group,{children:[(0,l.tZ)(p.a.Title,{description:(0,y.localizationKeys)("billing.subscriptionDetails.currentBillingCycle")}),(0,l.tZ)(p.a.Description,{text:"month"===e.planPeriod?(0,y.localizationKeys)("billing.monthly"):(0,y.localizationKeys)("billing.annually")})]}),(0,l.BX)(p.a.Group,{children:[(0,l.tZ)(p.a.Title,{description:(0,y.localizationKeys)("billing.subscriptionDetails.".concat(t?"firstPaymentOn":"nextPaymentOn"))}),(0,l.tZ)(p.a.Description,{text:(0,m.p)(i.nextPayment.date)})]}),(0,l.BX)(p.a.Group,{children:[(0,l.tZ)(p.a.Title,{description:(0,y.localizationKeys)("billing.subscriptionDetails.".concat(t?"firstPaymentAmount":"nextPaymentAmount"))}),(0,l.tZ)(p.a.Description,{prefix:i.nextPayment.amount.currency,text:"".concat(i.nextPayment.amount.currencySymbol).concat(i.nextPayment.amount.amountFormatted)})]})]})}let C=e=>{let{subscription:i}=e,{portalRoot:t}=(0,r.F)(),{__internal_openCheckout:s}=(0,n.cL)(),c=(0,g.useSubscriberTypeContext)(),{setIsOpen:u}=(0,d.useDrawerContext)(),{revalidateAll:p}=(0,g.usePlansContext)(),{setSubscription:b,setConfirmationOpen:m}=(0,a.useContext)(D),h=(0,o.N2)(e=>e({permission:"org:sys_billing:manage"})),S="user"===c||h,v=("month"===i.planPeriod&&!!i.plan.annualMonthlyFee||"annual"===i.planPeriod)&&"past_due"!==i.status,x=!i.plan.hasBaseFee,z=null===i.canceledAt&&!x,f=null!==i.canceledAt&&!x,C=(0,a.useCallback)(e=>{u&&u(!1),s({...e,onSubscriptionComplete:()=>{p()},portalRoot:t})},[s,p,t,u]),Z=a.useMemo(()=>S?[v?{label:"month"===i.planPeriod?(0,y.localizationKeys)("billing.switchToAnnualWithAnnualPrice",{price:(0,g.normalizeFormatted)(i.plan.annualFee.amountFormatted),currency:i.plan.annualFee.currencySymbol}):(0,y.localizationKeys)("billing.switchToMonthlyWithPrice",{price:(0,g.normalizeFormatted)(i.plan.fee.amountFormatted),currency:i.plan.fee.currencySymbol}),onClick:()=>{C({planId:i.plan.id,planPeriod:"month"===i.planPeriod?"annual":"month",for:c})}}:null,z?{isDestructive:!0,label:i.isFreeTrial?(0,y.localizationKeys)("billing.cancelFreeTrial",{plan:i.plan.name}):(0,y.localizationKeys)("billing.cancelSubscription"),onClick:()=>{b(i),m(!0)}}:null,f?{label:(0,y.localizationKeys)("billing.reSubscribe"),onClick:()=>{C({planId:i.plan.id,planPeriod:i.planPeriod,for:c})}}:null].filter(e=>null!==e):[],[v,i,z,C,c,b,S,f,m]);return 0===Z.length?null:(0,l.tZ)(y.Flex,{elementDescriptor:y.descriptors.subscriptionDetailsCardActions,gap:2,sx:e=>({paddingInline:e.space.$3,paddingBlock:e.space.$3,borderBlockStartWidth:e.borderWidths.$normal,borderBlockStartStyle:e.borderStyles.$solid,borderBlockStartColor:e.colors.$borderAlpha100}),children:Z.map((e,i)=>(0,l.tZ)(y.Button,{elementDescriptor:e.isDestructive?y.descriptors.subscriptionDetailsCancelButton:y.descriptors.subscriptionDetailsActionButton,variant:e.isDestructive?"ghost":"outline",colorScheme:e.isDestructive?"danger":void 0,size:"xs",textVariant:"buttonSmall",onClick:e.onClick,localizationKey:e.label},i))})},Z=e=>{let{subscription:i}=e,{t}=(0,y.useLocalizations)(),n="month"===i.planPeriod?i.plan.fee:i.plan.annualFee;return(0,l.BX)(y.Col,{elementDescriptor:y.descriptors.subscriptionDetailsCard,sx:e=>({borderRadius:e.radii.$md,boxShadow:e.shadows.$tableBodyShadow}),children:[(0,l.BX)(y.Col,{elementDescriptor:y.descriptors.subscriptionDetailsCardBody,gap:3,sx:e=>({padding:e.space.$3}),children:[(0,l.BX)(y.Flex,{elementDescriptor:y.descriptors.subscriptionDetailsCardHeader,align:"center",gap:2,children:[i.plan.avatarUrl?(0,l.tZ)(s.q,{boxElementDescriptor:y.descriptors.planDetailAvatar,size:e=>40,title:i.plan.name,rounded:!1,imageUrl:i.plan.avatarUrl}):null,(0,l.tZ)(y.Text,{elementDescriptor:y.descriptors.subscriptionDetailsCardTitle,variant:"h2",sx:e=>({fontSize:e.fontSizes.$lg,fontWeight:e.fontWeights.$semibold,color:e.colors.$colorForeground,marginInlineEnd:"auto"}),children:i.plan.name}),(0,l.tZ)(h.u,{subscription:i.isFreeTrial?{status:"free_trial"}:i,elementDescriptor:y.descriptors.subscriptionDetailsCardBadge})]}),(0,l.tZ)(y.Flex,{justify:"between",align:"center",children:(0,l.BX)(y.Text,{variant:"body",colorScheme:"secondary",sx:e=>({fontWeight:e.fontWeights.$medium,textTransform:"lowercase"}),children:[n.currencySymbol,n.amountFormatted," /"," ",t((0,y.localizationKeys)("billing.".concat("month"===i.planPeriod?"month":"year")))]})})]}),i.pastDueAt?(0,l.tZ)(K,{label:(0,y.localizationKeys)("billing.subscriptionDetails.pastDueAt"),value:(0,m.p)(i.pastDueAt)}):null,"active"===i.status?(0,l.BX)(l.HY,{children:[(0,l.tZ)(K,{label:i.isFreeTrial?(0,y.localizationKeys)("billing.subscriptionDetails.trialStartedOn"):(0,y.localizationKeys)("billing.subscriptionDetails.subscribedOn"),value:(0,m.p)(i.createdAt)}),i.periodEnd&&(0,l.tZ)(K,{label:i.canceledAt?(0,y.localizationKeys)("billing.subscriptionDetails.endsOn"):i.isFreeTrial?(0,y.localizationKeys)("billing.subscriptionDetails.trialEndsOn"):(0,y.localizationKeys)("billing.subscriptionDetails.renewsAt"),value:(0,m.p)(i.periodEnd)})]}):null,"upcoming"===i.status?(0,l.tZ)(K,{label:(0,y.localizationKeys)("billing.subscriptionDetails.beginsOn"),value:(0,m.p)(i.periodStart)}):null,(0,l.tZ)(C,{subscription:i})]})},K=e=>{let{label:i,value:t}=e;return(0,l.BX)(y.Flex,{elementDescriptor:y.descriptors.subscriptionDetailsDetailRow,justify:"between",align:"center",sx:e=>({paddingInline:e.space.$3,paddingBlock:e.space.$3,borderBlockStartWidth:e.borderWidths.$normal,borderBlockStartStyle:e.borderStyles.$solid,borderBlockStartColor:e.colors.$borderAlpha100}),children:[(0,l.tZ)(y.Text,{elementDescriptor:y.descriptors.subscriptionDetailsDetailRowLabel,localizationKey:i}),(0,l.tZ)(y.Text,{elementDescriptor:y.descriptors.subscriptionDetailsDetailRowValue,colorScheme:"secondary",children:t})]})}},95746:function(e,i,t){t.d(i,{u:()=>r});var l=t(73312),n=t(64204);let a={active:"badge__activePlan",upcoming:"badge__upcomingPlan",past_due:"badge__pastDuePlan",free_trial:"badge__freeTrial"},o={active:"secondary",upcoming:"primary",past_due:"warning",free_trial:"secondary"},r=e=>{let{subscription:i,elementDescriptor:t}=e;return(0,l.tZ)(n.Badge,{elementDescriptor:t,colorScheme:o[i.status],localizationKey:(0,n.localizationKeys)(a[i.status])})}}}]);